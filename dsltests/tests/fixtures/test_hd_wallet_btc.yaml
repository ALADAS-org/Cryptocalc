# Test de génération d'un wallet HD Bitcoin
name: "HD Wallet Generation - Bitcoin"
description: "Test la génération complète d'un wallet BIP32 pour Bitcoin"

imports:
  - CryptoService
  - BIP32Service

setup:
  entropy_size: 256
  blockchain: BTC
  wallet_mode: HD_WALLET

tests:
  - name: "Generate HD wallet with 256-bit entropy"
    steps:
      - action: generateEntropy
        params:
          size: 256
        assign: entropy
        
      - action: generateWallet
        params:
          type: HD_WALLET
          entropy: $entropy
          blockchain: BTC
        assign: wallet
        
    assertions:
      - property: $entropy
        isDefined: true
        
      - property: $entropy
        hasLength: 64  # 256 bits = 64 hex chars
        
      - property: $wallet.secretPhrase
        isDefined: true
        
      - property: $wallet.secretPhrase
        hasLength: 23  # Approximation pour 256 bits
        
      - property: $wallet.address
        matches: "^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$"
        
      - property: $wallet.privateKey
        isDefined: true
        
      - property: $wallet.privateKey
        hasLength: 64  # SHA256 = 64 hex chars
        
      - property: $wallet.wif
        isDefined: true
        
      - property: $wallet.type
        equals: HD_WALLET

  - name: "Generate HD wallet with 128-bit entropy"
    steps:
      - action: generateEntropy
        params:
          size: 128
        assign: entropy_128
        
      - action: generateWallet
        params:
          type: HD_WALLET
          entropy: $entropy_128
          blockchain: BTC
        assign: wallet_128
        
    assertions:
      - property: $entropy_128
        hasLength: 32  # 128 bits = 32 hex chars
        
      - property: $wallet_128.secretPhrase
        isDefined: true
        
      - property: $wallet_128.address
        matches: "^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$"

  - name: "Generate HD wallet with passphrase (BIP32)"
    steps:
      - action: generateEntropy
        params:
          size: 256
        assign: entropy_pass
        
      - action: generateWallet
        params:
          type: HD_WALLET
          entropy: $entropy_pass
          blockchain: BTC
          passphrase: "MySecurePassphrase123!"
        assign: wallet_pass
        
    assertions:
      - property: $wallet_pass.passphrase
        equals: "MySecurePassphrase123!"
        
      - property: $wallet_pass.privateKey
        notEquals: null
        
      # Avec passphrase, la clé doit être différente
      - property: $wallet_pass.address
        isDefined: true
